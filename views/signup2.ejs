<!DOCTYPE html>
<html>

<head>
    <title>Hexbubble Signup</title>
    <% include head %>
</head>

<body>
    <div class='container'>
        <div class='login'>
            <h1>Continue Signup...</h1>
            <br>
            <form id='signup'>
                <textarea placeholder="Biography..." class='bio' name='bio'></textarea>
                <br>
                <div class='signupImg'>
                    <h4>Profile Picture:</h4>
                    <input type="file" id='profilePic' name='profilePic'>
                </div>
            </form>
            <div class='profilePicPreview' id='profilePicPreview'></div>
            <div class='button' onclick="signup2()">Signup</div>
        </div>
        <br>
        <div class='button' onclick="window.location.href = '/'">Or Skip...</div>
    </div>
    <script src="/jquery.js"></script>
    <script src="/load-image.js"></script>
    <script src="/jq-progress.js"></script>
    <script>
    document.getElementById('profilePic').onchange = function (e) {
        loadImage(e.target.files[0], function (img) {
                $("#profilePicPreview").html(img);
            }, { // Options
                maxWidth: 150,
                maxHeight: 150
            } 
        );
    };

    function signup2() {
    	let files = $('#profilePic')[0].files;
        let file = files[0];
        if (files.length < 1) {
            alert("No files chosen to upload");
            return false;
        }
        if (file.size > (1024 * 1024 * 2)) {
            alert("Max total file size of 2mb reached");
            return false;
        }

        var formData = new FormData($("#signup")[0]);
        $.ajax({
            url: "/signup/2",
            type: 'POST',
            data: formData,
            async: true,
            success: function (data) {
                if (data.success) {
                    window.location.href = "/feed";
                } else {
                    console.log(data);
                }
            },
            cache: false,
            contentType: false,
            processData: false
        }).uploadProgress(function (e) {
            if (e.lengthComputable) {
                var percentage = Math.round((e.loaded * 100) / e.total);
                console.log(percentage);
            }
        });
    }
    </script>
</body>

</html>